<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Klan Oyun Prototip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    :root {
      --blue: #49a7f9;
      --red: #ff5b7c;
      --yellow: #ffd237;
      --purple: #b785ee;
      --panel: #23232e;
      --panel2: #161823;
      --gray: #23242b;
      --bg: #191a23;
      --radius: 20px;
      --shadow: 0 4px 22px #0007;
    }
    html, body {margin:0;padding:0;background:var(--bg);color:#f7f8fc;font-family:'Segoe UI',Arial,sans-serif;}
    * {box-sizing:border-box;}
    #app {max-width:1200px;margin:0 auto;min-height:100vh;display:flex;}
    /* --------- SOL PANEL --------- */
    #solPanel {
      width:92px;min-width:77px;max-width:130px;
      background:var(--panel);
      display:flex;flex-direction:column;align-items:center;
      gap:18px;padding:23px 6px 12px 6px;
      box-shadow:2px 0 20px #0007;
      z-index:3;
    }
    .sideBtn {
      background:linear-gradient(90deg,#272943,#23232a 60%);
      color:#fff;border:none;
      border-radius:13px;padding:12px 8px;margin-bottom:7px;
      font-size:1.17rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:3px;transition:all .19s;
      width:74px;
      box-shadow:0 1px 8px #0003;
    }
    .sideBtn.active, .sideBtn:hover {background:linear-gradient(90deg,#45a6ff,#b785ee 80%);}
    .sideBtn .bi {font-size:1.43rem;}
    /* --------- ORTA ANA ALAN --------- */
    #ortaPanel {flex:1;display:flex;flex-direction:column;min-height:100vh;}
    /* ---- ÜST STAT ----- */
    #ustStat {
      display:flex;align-items:center;justify-content:space-between;
      background:var(--panel2);padding:17px 28px 10px 26px;
      border-radius:0 0 27px 0;box-shadow:0 5px 20px #0006;z-index:2;
      gap:22px;
    }
    .userStat {display:flex;align-items:center;gap:22px;}
    .userInfo {font-size:1.05rem;}
    .xpBarDis {
      width:196px;background:#262b40;border-radius:9px;overflow:hidden;height:21px;box-shadow:0 2px 7px #0004;margin-left:9px;
    }
    .xpBarIc {background:linear-gradient(90deg,#ffd237,#b785ee 90%);height:100%;transition:width .35s;color:#222;padding-left:8px;font-weight:700;}
    .puanBox {background:#ffd237;color:#181929;padding:5px 16px 5px 13px;font-weight:700;border-radius:13px;font-size:1.01rem;margin-left:14px;}
    /* ---- KLAN INFO ---- */
    .klanInfoBar {display:flex;align-items:center;gap:14px;}
    .klanLogo {font-size:2.1rem;}
    .klanAd {font-size:1.14rem;font-weight:700;}
    /* ---- HARİTA ---- */
    #haritaDis {flex:1;display:flex;position:relative;}
    #harita {flex:1;height:72vh;min-height:310px;border-radius:24px;margin:21px 14px 0 10px;box-shadow:0 2px 24px #0008;}
    /* ---- HIZLI MENU POPUP ---- */
    #haritaMenuPopup {
      display:none;position:absolute;z-index:11;
      background:var(--panel2);padding:18px 16px;border-radius:15px;box-shadow:0 2px 20px #000b;top:40%;left:49%;
      transform:translate(-50%,-50%);
    }
    #haritaMenuPopup button {
      display:block;width:160px;padding:11px 0;font-size:1.08rem;margin:10px auto 0 auto;background:linear-gradient(90deg,#ffd237,#b785ee 80%);
      border:none;border-radius:13px;cursor:pointer;color:#181929;font-weight:700;box-shadow:0 1px 9px #0002;
    }
    /* ---- TIMELINE ---- */
    #timelinePanel {
      background:var(--panel);margin:18px 15px 0 11px;border-radius:19px;padding:12px 19px 16px 19px;
      min-height:86px;max-height:220px;overflow:auto;box-shadow:0 2px 12px #0003;
    }
    .timelineTitle {font-size:1.13rem;font-weight:700;margin-bottom:7px;}
    .timelineItem {font-size:1rem;padding:7px 0;border-bottom:1px solid #fff1;}
    .timelineItem:last-child {border-bottom:none;}
    /* --- Responsive (mobil) --- */
    @media (max-width:900px) {
      #app {flex-direction:column;}
      #solPanel {flex-direction:row;width:100vw;min-width:0;max-width:none;padding:7px 2vw 8px 2vw;gap:13px;box-shadow:0 -2px 20px #0006;}
      .sideBtn {padding:8px 2px;width:60px;font-size:1.02rem;}
      #ustStat {padding:12px 7vw 6px 6vw;}
      #harita {margin:11px 2vw 0 2vw;border-radius:13px;min-height:210px;}
      #timelinePanel {margin:11px 3vw 0 3vw;border-radius:13px;}
    }
  </style>
</head>
<body>
<div id="app">
  <!-- SOL PANEL -->
  <div id="solPanel">
    <button class="sideBtn" id="btnKlanSira"><span class="bi bi-award"></span> <span style="font-size:.9em;">Sıralama</span></button>
    <button class="sideBtn" id="btnKlanim"><span class="bi bi-trophy"></span> <span style="font-size:.9em;">Klanım</span></button>
  </div>
  <!-- ORTA ANA PANEL -->
  <div id="ortaPanel">
    <!-- ÜST STAT -->
    <div id="ustStat">
      <div class="userStat">
        <div class="userInfo">Seviye <b id="seviye">7</b></div>
        <div class="xpBarDis"><div class="xpBarIc" id="xpBarIc" style="width:49%;">620 / 1250 XP</div></div>
        <span class="puanBox">Puan: <span id="puan">8.4</span> / 10</span>
        <span class="puanBox">NS: <span id="ns">1560</span></span>
        <span class="puanBox">N: <span id="n">21</span></span>
      </div>
      <div class="klanInfoBar">
        <span class="klanLogo" id="klanLogo">🦄</span>
        <span class="klanAd" id="klanAd">Mor Klan</span>
      </div>
    </div>
    <!-- HARİTA ALANI -->
    <div id="haritaDis" style="position:relative;">
      <div id="harita"></div>
      <div id="haritaMenuPopup">
        <div><b>Ne yapmak istersin?</b></div>
        <button onclick="secHaritaEtkinlik('fire')">Ateş Yak</button>
        <button onclick="secHaritaEtkinlik('flag')">Bayrak Dik</button>
        <button onclick="haritaMenuKapat()">Vazgeç</button>
      </div>
    </div>
    <!-- TIMELINE -->
    <div id="timelinePanel">
      <div class="timelineTitle">Klan Aktivite Akışı</div>
      <div id="timelineList"></div>
    </div>
  </div>
  <!-- POPUPLAR -->
  <div id="popup" class="popup" style="display:none;"></div>
</div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ---- VERİ ----
const KLANS = [
  {id:"blue", name:"Mavi Klan", logo:"🦅", color:"#49a7f9",puan:7120,ns:1212,n:18},
  {id:"red", name:"Kırmızı Klan", logo:"🔥", color:"#ff5b7c",puan:8330,ns:1382,n:23},
  {id:"yellow", name:"Sarı Klan", logo:"🌟", color:"#ffd237",puan:9540,ns:1621,n:33},
  {id:"purple", name:"Mor Klan", logo:"🦄", color:"#b785ee",puan:8870,ns:1560,n:21}
];
let kullanici = {
  isim: "Demo", klan: 3, // 0-mavi, 1-kırmızı, 2-sarı, 3-mor
  xp: 620, xpGerek: 1250, seviye: 7, puan: 8.4, ns: 1560, n: 21
};
let timeline = [
  "Hoş geldin! Bugünkü hedef: 1 bayrak dik, 2 ateş yak!",
  "Mor Klan bugün 3 yeni üye kazandı.",
  "Klan Ateşi: Kadıköy'de etkinlik başlatıldı!",
  "Mor Klan Ankara'da bayrak bölgesini fethetti."
];
// ---- UI INIT ----
window.onload = function() {
  guncelleKlanInfo();
  timelineYaz();
  haritaInit();
};
// ---- SOL PANEL BUTONLARI ----
document.getElementById('btnKlanSira').onclick = function(){
  popupGoster(klanSiralamaPopupHTML());
};
document.getElementById('btnKlanim').onclick = function(){
  popupGoster(klanimPopupHTML());
};
// ---- STAT ----
function guncelleKlanInfo() {
  let k = KLANS[kullanici.klan];
  document.getElementById('klanLogo').innerText = k.logo;
  document.getElementById('klanAd').innerText = k.name;
  document.getElementById('seviye').innerText = kullanici.seviye;
  document.getElementById('xpBarIc').style.width = (100*kullanici.xp/kullanici.xpGerek) + "%";
  document.getElementById('xpBarIc').innerText = kullanici.xp+" / "+kullanici.xpGerek+" XP";
  document.getElementById('puan').innerText = kullanici.puan;
  document.getElementById('ns').innerText = k.ns;
  document.getElementById('n').innerText = k.n;
}
// ---- TIMELINE ----
function timelineYaz() {
  let l = document.getElementById('timelineList');
  l.innerHTML = timeline.slice(-12).reverse().map(e=>`<div class="timelineItem">${e}</div>`).join('');
}
function timelineEkle(msg) {
  timeline.push(msg);
  timelineYaz();
}
// ---- HARİTA ve ETKİNLİK SEÇİMİ ----
let haritaMenuAktif = false, sonTikKoord = null;
function haritaInit(){
  window.haritaMap = L.map('harita').setView([39,34],6);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
    maxZoom:17,attribution:'&copy; <a href="https://carto.com/">CartoDB</a>'
  }).addTo(window.haritaMap);

  window.haritaMap.on('click', function(e){
    sonTikKoord = e.latlng;
    haritaMenuGoster(e.containerPoint);
  });
}
function haritaMenuGoster(pt){
  let mp = document.getElementById('haritaMenuPopup');
  mp.style.display="block";
  if(window.innerWidth<900){
    mp.style.top="51%";mp.style.left="51%";
  } else {
    mp.style.top=(pt.y+70)+"px";
    mp.style.left=(pt.x+160)+"px";
  }
  haritaMenuAktif = true;
}
function haritaMenuKapat(){
  document.getElementById('haritaMenuPopup').style.display="none";
  haritaMenuAktif = false;
}
// ---- Haritada Etkinlik Seçimi ----
function secHaritaEtkinlik(tip){
  haritaMenuKapat();
  if(tip=="fire"){
    let marker = L.marker([sonTikKoord.lat,sonTikKoord.lng]).addTo(window.haritaMap);
    marker.bindPopup('<b>🔥 Ateş Yakıldı!</b>').openPopup();
    let msg = `<b>${KLANS[kullanici.klan].logo} ${KLANS[kullanici.klan].name}</b> - Yeni <b>Ateş</b> yakıldı! (${sonTikKoord.lat.toFixed(2)}, ${sonTikKoord.lng.toFixed(2)})`;
    timelineEkle(msg);
    // XP, puan vs örnek güncelle
    kullanici.xp += 110; if(kullanici.xp>=kullanici.xpGerek){kullanici.seviye++;kullanici.xp=0;}
    guncelleKlanInfo();
  }
  if(tip=="flag"){
    let marker = L.marker([sonTikKoord.lat,sonTikKoord.lng]).addTo(window.haritaMap);
    marker.bindPopup('<b>🚩 Bayrak Dikildi!</b>').openPopup();
    let msg = `<b>${KLANS[kullanici.klan].logo} ${KLANS[kullanici.klan].name}</b> - Yeni <b>Bayrak</b> dikildi! (${sonTikKoord.lat.toFixed(2)}, ${sonTikKoord.lng.toFixed(2)})`;
    timelineEkle(msg);
    // puan NS güncelle
    KLANS[kullanici.klan].n++;
    KLANS[kullanici.klan].ns+=19;
    guncelleKlanInfo();
  }
}

// ---- POPUPLAR ----
function popupGoster(html){
  let p = document.getElementById('popup');
  p.innerHTML = html;
  p.style.display = "block";
}
function popupKapat(){document.getElementById('popup').style.display="none";}
document.addEventListener('click',function(e){
  let p=document.getElementById('popup');
  if(p.style.display==="block" && !e.target.closest('.popup') && !e.target.closest('.sideBtn')) popupKapat();
});

// ---- Klan Sıralama / Klanım POPUP HTML ----
function klanSiralamaPopupHTML(){
  let sorted = KLANS.slice().sort((a,b)=>b.puan-a.puan);
  let html = `<h4><i class="bi bi-award"></i> Klan Sıralaması</h4>`;
  sorted.forEach((k,i)=>{
    html += `<div class="timelineItem" style="color:${k.color}">${i+1}. ${k.logo} <b>${k.name}</b> - ⭐${k.puan} | NS:${k.ns} | N:${k.n}</div>`;
  });
  html += `<button onclick="popupKapat()" class="fireBtn" style="margin-top:10px;">Kapat</button>`;
  return html;
}
function klanimPopupHTML(){
  let k = KLANS[kullanici.klan];
  let html = `<h4>${k.logo} ${k.name}</h4>`;
  html += `<div class="timelineItem"><b>Puan:</b> ${k.puan}</div>
           <div class="timelineItem"><b>NS:</b> ${k.ns}</div>
           <div class="timelineItem"><b>N:</b> ${k.n}</div>
           <div class="timelineItem"><b>Slogan:</b> En iyi klan burası!</div>
           <button onclick="popupKapat()" class="fireBtn" style="margin-top:10px;">Kapat</button>`;
  return html;
}
</script>
</body>
</html>
