<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>KlanApp - Topluluk Oyunu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    :root {
      --blue: #32a1f5;
      --red: #ff5a5a;
      --yellow: #ffd237;
      --purple: #b180ea;
      --gray: #23242e;
      --bg: #191b21;
      --text: #f2f2ff;
    }
    html, body {margin:0;padding:0;background:var(--bg);color:var(--text);font-family:'Segoe UI',Arial,sans-serif;}
    * {box-sizing:border-box;}
    #app {max-width:500px;margin:0 auto;min-height:100vh;box-shadow:0 0 32px #0008;}
    .fadein {animation:fadein .36s;}
    @keyframes fadein {0%{opacity:0;transform:translateY(30px);}100%{opacity:1;transform:none;}}

    /* Giri≈ü ekranƒ± */
    .giris-kap {display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:var(--bg);}
    .giris-logo {font-size:2.9rem;margin-bottom:19px;font-weight:700;letter-spacing:0.09em;}
    .giris-title {font-size:1.35rem;margin-bottom:22px;}
    .giris-form {display:flex;flex-direction:column;align-items:center;width:100%;}
    .giris-form input {padding:14px 16px;border-radius:18px;font-size:1.14rem;margin-bottom:18px;border:none;outline:none;background:#252635;color:#fff;width:220px;box-shadow:0 2px 16px #0002;}
    .giris-form button {background:linear-gradient(90deg,#32a1f5 30%,#b180ea 90%);color:#fff;font-weight:700;font-size:1.18rem;padding:12px 49px;border-radius:26px;border:none;box-shadow:0 2px 24px #0002;cursor:pointer;transition:background .2s;}
    .giris-form button:hover {background:linear-gradient(90deg,#4eb6ff 10%,#c8a5f6 90%);}

    /* Klan se√ßimi ekranƒ± */
    .klan-secim-kap {display:none;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;}
    .klan-secim-title {font-size:1.23rem;margin-bottom:22px;font-weight:600;}
    .klan-list {display:flex;flex-wrap:wrap;gap:21px;justify-content:center;}
    .klan-card {
      background:#252635; border-radius:19px;box-shadow:0 1px 17px #0003;
      width:110px; min-height:170px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform .18s,box-shadow .18s;
      border:3px solid transparent; position:relative;
    }
    .klan-card.selected {transform:scale(1.09);box-shadow:0 6px 24px #0006;border:3px solid #fff6;}
    .klan-blue {color:var(--blue);}
    .klan-red {color:var(--red);}
    .klan-yellow {color:var(--yellow);}
    .klan-purple {color:var(--purple);}
    .klan-logo {font-size:2.7rem;}
    .klan-name {font-size:1.07rem;font-weight:700;margin:7px 0 4px 0;}
    .klan-desc {font-size:.95rem;opacity:.7;}
    .klan-secim-btn {margin-top:38px;font-size:1.13rem;padding:13px 44px;background:linear-gradient(90deg,#32a1f5,#b180ea 80%);color:#fff;border:none;border-radius:27px;box-shadow:0 2px 14px #0002;font-weight:700;cursor:pointer;}
    .klan-secim-btn:disabled {background:#555;opacity:.7;cursor:not-allowed;}

    /* Ana uygulama */
    #mainApp {display:none;}
    .main-tab{min-height:66vh;}
    .menu-btn{
      flex:1 1 0;padding:8px 0 4px 0;font-size:1.05rem;color:#fff;background:none;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;border-bottom:3px solid transparent;transition:border .2s;font-weight:600;
    }
    .menu-btn.active,.menu-btn:hover{border-bottom:3px solid var(--primary);}
    .menu-ikon{font-size:23px;margin-bottom:1px;}
    #jetonBox{
      position:absolute;right:22px;top:18px;z-index:11;background:linear-gradient(90deg,#ffd237,#fff6);
      color:#222;border-radius:20px;padding:6px 18px 6px 11px;font-weight:700;box-shadow:0 2px 18px #0002;display:flex;align-items:center;gap:6px;
    }
    /* Harita paneli */
    #haritaBox {width:100vw;max-width:500px;height:64vh;border-radius:0 0 24px 24px;box-shadow:0 1px 14px #0006;overflow:hidden;margin:0 auto;position:relative;}
    #harita {width:100%;height:100%;}
    /* Klan kutusu */
    #klanPanel{position:absolute;left:14px;bottom:14px;z-index:10;}
    #klanInfoBtn{background:var(--gray);border-radius:16px 21px 18px 15px;padding:9px 16px;display:flex;align-items:center;gap:9px;box-shadow:0 2px 10px #0003;cursor:pointer;}
    #klanLogo{font-size:25px;}
    #klanName{font-size:1.03rem;font-weight:700;}
    #klanPopup, #tumKlanlarPopup{
      display:none;position:absolute;bottom:55px;left:0;z-index:100;background:#24283ab8;padding:13px 15px 13px 13px;
      border-radius:15px 19px 16px 14px;min-width:172px;box-shadow:0 2px 20px #0007;font-size:0.98rem;
    }
    #tumKlanlarPopup{bottom:150px;min-width:185px;}
    /* Kartlar, butonlar */
    .fireBtn{background:linear-gradient(90deg,var(--primary) 55%,#ffd237 90%);color:#23222f;font-weight:700;font-size:1.05rem;padding:8px 22px;border-radius:19px;border:none;margin:5px 3px;box-shadow:0 2px 10px #0002;cursor:pointer;}
    .fireBtn:hover{background:linear-gradient(90deg,#ffd237 20%,var(--primary) 80%);}
    .profilCard{background:var(--gray);padding:8px 18px;border-radius:13px;margin-bottom:5px;font-size:1rem;}
    @media (max-width:700px){
      #app{max-width:100vw;box-shadow:none;}
      .klan-list{gap:13px;}
      .klan-card{width:45vw;min-width:110px;max-width:170px;}
      #mainMenu{height:61px;}
      #icerikKap{padding-bottom:66px;}
      #haritaBox{height:55vh;}
    }
    /* Tema renkleri */
    body[data-theme="blue"] {--bg:#162031;--gray:#1d2430;--primary:var(--blue);}
    body[data-theme="red"] {--bg:#2a181a;--gray:#291d21;--primary:var(--red);}
    body[data-theme="yellow"] {--bg:#2c2b16;--gray:#2c291b;--primary:var(--yellow);}
    body[data-theme="purple"] {--bg:#25192c;--gray:#251d2c;--primary:var(--purple);}
  </style>
</head>
<body>
<div id="app">
  <!-- Giri≈ü -->
  <div id="girisKap" class="giris-kap fadein">
    <div class="giris-logo">üåå KLANAPP</div>
    <div class="giris-title">Sana ait, ger√ßek bir topluluk!</div>
    <form class="giris-form" onsubmit="event.preventDefault(); girisYap();">
      <input id="kullaniciAdi" type="text" maxlength="24" autocomplete="off" placeholder="ƒ∞smini yaz..." required>
      <button type="submit">Giri≈ü</button>
    </form>
  </div>
  <!-- Klan Se√ßimi -->
  <div id="klanSecimKap" class="klan-secim-kap fadein">
    <div class="klan-secim-title">Klanƒ±nƒ± Se√ß</div>
    <div class="klan-list" id="klanList">
      <!-- Klanlar JS ile √ºretilecek -->
    </div>
    <button id="klanSecBtn" class="klan-secim-btn" disabled>Klanƒ± Se√ß</button>
  </div>
  <!-- Ana Uygulama -->
  <div id="mainApp">
    <div id="jetonBox" style="display:none;">
      <span style="font-size:21px;">ü™ô</span><span id="jetonSayisi">850</span>
    </div>
    <div id="mainMenu" style="display:none;position:fixed;bottom:0;left:0;width:100vw;z-index:21;display:flex;justify-content:space-around;align-items:center;background:var(--gray);padding:0;height:65px;box-shadow:0 -2px 24px #0005;">
      <button class="menu-btn active" data-tab="map"><span class="menu-ikon">üó∫Ô∏è</span><div>Harita</div></button>
      <button class="menu-btn" data-tab="store"><span class="menu-ikon">üè™</span><div>Maƒüaza</div></button>
      <button class="menu-btn" data-tab="fire"><span class="menu-ikon">üî•</span><div>Klan Ate≈üi</div></button>
      <button class="menu-btn" data-tab="profile"><span class="menu-ikon">üë§</span><div>Profil</div></button>
      <button class="menu-btn" data-tab="flag"><span class="menu-ikon">üö©</span><div>Bayrak</div></button>
      <button class="menu-btn" data-tab="qr"><span class="menu-ikon">üî≥</span><div>QR</div></button>
      <button class="menu-btn" data-tab="ref"><span class="menu-ikon">üéÅ</span><div>Davet</div></button>
    </div>
    <div id="icerikKap" style="padding-bottom:75px;">
      <!-- 1. Harita Tabƒ± -->
      <div id="tab-map" class="main-tab fadein" style="display:none;">
        <div id="haritaBox">
          <div id="harita"></div>
          <!-- Sol alt klan kutusu -->
          <div id="klanPanel">
            <div id="klanInfoBtn">
              <span id="klanLogo"></span>
              <span id="klanName"></span>
            </div>
            <!-- Popup -->
            <div id="klanPopup">
              <div style="font-size:1.06rem;font-weight:700;margin-bottom:8px;" id="klanPopupTitle"></div>
              <div>üåü Puan: <span id="klanPuan"></span></div>
              <div>üö© Bayrak: <span id="klanBayrak"></span></div>
              <div>üë• √úye: <span id="klanUye"></span></div>
              <div style="margin:8px 0 0 0;"><button id="tumKlanlarBtn" style="padding:4px 13px;border-radius:11px;background:var(--primary);color:#fff;font-weight:600;border:none;cursor:pointer;">T√ºm Klanlar</button></div>
            </div>
            <div id="tumKlanlarPopup">
              <div style="font-size:1.02rem;font-weight:700;margin-bottom:7px;">üèÜ T√ºm Klanlar</div>
              <div id="tumKlanlarList"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- Diƒüer sekmeler -->
      <div id="tab-store" class="main-tab fadein" style="display:none;"></div>
      <div id="tab-fire" class="main-tab fadein" style="display:none;"></div>
      <div id="tab-profile" class="main-tab fadein" style="display:none;"></div>
      <div id="tab-flag" class="main-tab fadein" style="display:none;"></div>
      <div id="tab-qr" class="main-tab fadein" style="display:none;"></div>
      <div id="tab-ref" class="main-tab fadein" style="display:none;"></div>
    </div>
  </div>
</div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ---- GLOBAL VERƒ∞LER ----
const KLANS = [
  {id:"blue",   name:"Mavi Klan",    desc:"Strateji & Liderlik", logo:"ü¶Ö",   color:"#32a1f5"},
  {id:"red",    name:"Kƒ±rmƒ±zƒ± Klan", desc:"Cesaret & Enerji",    logo:"üî•",   color:"#ff5a5a"},
  {id:"yellow", name:"Sarƒ± Klan",    desc:"Sosyallik & Parlaklƒ±k",logo:"üåü",  color:"#ffd237"},
  {id:"purple", name:"Mor Klan",     desc:"Hayal G√ºc√º & Yaratƒ±cƒ±lƒ±k",logo:"ü¶Ñ",color:"#b180ea"}
];
const KLANS_STATS = [
  {name:"Mavi Klan",logo:"ü¶Ö",color:"#32a1f5",puan:3120, bayrak:6, uye:310},
  {name:"Kƒ±rmƒ±zƒ± Klan",logo:"üî•",color:"#ff5a5a",puan:2850, bayrak:8, uye:280},
  {name:"Sarƒ± Klan",logo:"üåü",color:"#ffd237",puan:4100, bayrak:13, uye:370},
  {name:"Mor Klan",logo:"ü¶Ñ",color:"#b180ea",puan:3590, bayrak:11, uye:330}
];
const MAGAZA_URUNLER = [
  {isim:"√áƒ±rak Bileklik",fiyat:150,symbol:"‚¨õ"},
  {isim:"Usta Bileklik",fiyat:220,symbol:"ü¶Ö"},
  {isim:"XP Paketi",fiyat:60,symbol:"‚ö°"},
  {isim:"Klan Rozeti",fiyat:120,symbol:"üèÖ"},
  {isim:"R√ºtbe Y√ºkseltici",fiyat:330,symbol:"üéñÔ∏è"}
];
// ---- KULLANICI ----
let kullanici = {isim:"", klan:null};
let seciliKlan = null, seciliKlanObj = null;
let mainAppYuklu = false;

// Gƒ∞Rƒ∞≈û FONKSƒ∞YONLARI
function girisYap() {
  let isim = document.getElementById('kullaniciAdi').value.trim();
  if(!isim){alert("ƒ∞sminizi girin.");return;}
  kullanici.isim = isim;
  document.getElementById('girisKap').style.display="none";
  document.getElementById('klanSecimKap').style.display="flex";
  window.scrollTo(0,0);
  if(document.getElementById('klanList').children.length===0) klanlariYukle();
}
function klanlariYukle() {
  let list = document.getElementById('klanList');
  list.innerHTML = "";
  KLANS.forEach(k=>{
    let div = document.createElement('div');
    div.className = "klan-card klan-"+k.id;
    div.innerHTML = `<div class="klan-logo">${k.logo}</div>
      <div class="klan-name">${k.name}</div>
      <div class="klan-desc">${k.desc}</div>`;
    div.onclick = function() {
      document.querySelectorAll('.klan-card').forEach(card=>card.classList.remove('selected'));
      div.classList.add('selected');
      seciliKlan = k.id;
      document.getElementById('klanSecBtn').disabled = false;
    };
    list.appendChild(div);
  });
}
// KLAN SE√áƒ∞Mƒ∞
document.getElementById('klanSecBtn').onclick = function() {
  if(!seciliKlan) return;
  kullanici.klan = seciliKlan;
  seciliKlanObj = KLANS.find(k=>k.id===seciliKlan);
  // Tema g√ºncelle
  document.body.setAttribute("data-theme", seciliKlan);
  document.getElementById('klanSecimKap').style.display = "none";
  openMainApp();
};
// ---- ANA UYGULAMA ----
function openMainApp(){
  document.getElementById('mainApp').style.display="block";
  document.getElementById('jetonBox').style.display="flex";
  document.getElementById('mainMenu').style.display="flex";
  // Men√º ve ilk sekme
  document.querySelectorAll('.main-tab').forEach(t=>t.style.display="none");
  document.getElementById('tab-map').style.display="block";
  document.querySelectorAll('.menu-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector('.menu-btn[data-tab="map"]').classList.add('active');
  // Jeton demo
  document.getElementById('jetonSayisi').innerText = "850";
  // Klan paneli
  document.getElementById('klanLogo').innerText = seciliKlanObj.logo;
  document.getElementById('klanName').innerText = seciliKlanObj.name;
  document.getElementById('klanPopupTitle').innerText = seciliKlanObj.logo + " " + seciliKlanObj.name;
  guncelleKlanPopup();
  guncelleTumKlanlar();
  tablariYukle();
  setTimeout(haritaInit,120);
}
function guncelleKlanPopup(){
  let k = KLANS_STATS.find(kk=>kk.name===seciliKlanObj.name);
  document.getElementById('klanPuan').innerText = k.puan;
  document.getElementById('klanBayrak').innerText = k.bayrak;
  document.getElementById('klanUye').innerText = k.uye;
}
function guncelleTumKlanlar(){
  let html = "";
  KLANS_STATS.sort((a,b)=>b.puan-a.puan).forEach((k,i)=>{
    html += `<div style="display:flex;align-items:center;gap:7px;font-weight:600;margin:6px 0;">
      <span style="font-size:19px;">${k.logo}</span>
      <span style="color:${k.color};width:77px;">${k.name}</span>
      <span>üåü ${k.puan}</span> <span>üö©${k.bayrak}</span> <span>üë•${k.uye}</span>
    </div>`;
  });
  document.getElementById('tumKlanlarList').innerHTML = html;
}
// Klan kutusu popup ve t√ºm klanlar a√ß/kapa
document.addEventListener('click',function(e){
  if(e.target.closest('#klanInfoBtn')){document.getElementById('klanPopup').style.display="block";}
  else if(!e.target.closest('#klanPopup')){document.getElementById('klanPopup').style.display="none";}
  if(e.target.closest('#tumKlanlarBtn')){document.getElementById('tumKlanlarPopup').style.display="block";}
  else if(!e.target.closest('#tumKlanlarPopup')){document.getElementById('tumKlanlarPopup').style.display="none";}
});
// Men√º ge√ßi≈üleri
document.addEventListener('DOMContentLoaded',function(){
  document.querySelectorAll('.menu-btn').forEach(btn=>{
    btn.onclick = function(){
      document.querySelectorAll('.menu-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      let tab = btn.dataset.tab;
      document.querySelectorAll('.main-tab').forEach(t=>t.style.display="none");
      document.getElementById('tab-'+tab).style.display="block";
      if(tab==="map" && window.haritaMap) setTimeout(()=>window.haritaMap.invalidateSize(),100);
    };
  });
});
// ---- HARƒ∞TA (LEAFLET) ----
function haritaInit(){
  if(window.haritaMap) {window.haritaMap.invalidateSize(); return;}
  window.haritaMap = L.map('harita').setView([39,34], 6);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
    maxZoom:18,attribution:'&copy; <a href="https://carto.com/">CartoDB</a>'
  }).addTo(window.haritaMap);
  // Dummy marker: Klan √ºyeleri/alanlar
  let markers = [
    {lat:41.02,lng:29.02,text:"ü¶Ö 5 Mavi Klan √ºyesi burada!"},
    {lat:40.72,lng:30.41,text:"üåü 3 Sarƒ± Klan √ºyesi burada!"},
    {lat:38.43,lng:27.15,text:"ü¶Ñ Mor Klan alanƒ±"},
    {lat:39.92,lng:32.85,text:"üî• 2 Kƒ±rmƒ±zƒ± Klan √ºyesi burada!"}
  ];
  markers.forEach(m=>{
    let mark = L.marker([m.lat,m.lng]).addTo(window.haritaMap);
    mark.bindPopup(m.text);
  });
}
// --------- T√ºm SEKMELERƒ∞N ƒ∞√áERƒ∞ƒûƒ∞ ---------
function tablariYukle() {
  urunleriYukle();
  klanAtesiYukle();
  profilYukle();
  bayrakPanelYukle();
  qrPanelYukle();
  davetPanelYukle();
}
// MAƒûAZA
function urunleriYukle(){
  let m = document.getElementById('tab-store');
  let html = `<h2>Maƒüaza</h2>
  <div id="magazaUrunler" style="display:flex;flex-wrap:wrap;gap:18px;justify-content:center;margin-top:23px;">`;
  MAGAZA_URUNLER.forEach(u=>{
    html += `<div style="background:var(--gray);border-radius:16px;padding:13px 14px 10px 14px;min-width:130px;max-width:150px;display:flex;flex-direction:column;align-items:center;box-shadow:0 1px 8px #0002;margin-bottom:11px;">
      <div style="font-size:2.1rem;">${u.symbol}</div>
      <div style="font-weight:700;margin:6px 0 5px 0;">${u.isim}</div>
      <div style="color:#ffd237;font-size:1.01rem;">‚Ç∫${u.fiyat}</div>
      <button onclick="alert('Demo: Satƒ±n alma hen√ºz aktif deƒüil!')" style="margin-top:6px;background:linear-gradient(90deg,#ffd237,#b180ea 80%);border:none;border-radius:18px;font-weight:700;color:#23222f;padding:6px 15px;cursor:pointer;">Satƒ±n Al</button>
    </div>`;
  });
  html += "</div>";
  m.innerHTML = html;
}
// KLAN ATE≈ûƒ∞
function klanAtesiYukle() {
  let f = document.getElementById('tab-fire');
  f.innerHTML = `
    <h2>Klan Ate≈üi</h2>
    <div style="background:rgba(80,0,0,.14);border-radius:15px;padding:17px 0 12px 0;max-width:330px;margin:0 auto 14px auto;">
      <div style="font-size:1.3rem;">üî• Kadƒ±k√∂y Etkinliƒüi</div>
      <div style="margin:9px 0;">Katƒ±lƒ±mcƒ±: <b>2 / 7</b></div>
      <button class="fireBtn" onclick="alert('Demo: Katƒ±ldƒ±n!')">Katƒ±l</button>
    </div>
    <button class="fireBtn" onclick="alert('Demo: Ate≈ü Yak!')">Ate≈ü Yak!</button>
  `;
}
// PROFƒ∞L
function profilYukle(){
  let p = document.getElementById('tab-profile');
  p.innerHTML = `
    <h2>Profil</h2>
    <div style="display:flex;align-items:center;gap:15px;margin-bottom:13px;">
      <div style="font-size:2.3rem;border-radius:30px;background:var(--gray);padding:8px 16px 5px 16px;">üë§</div>
      <div>
        <div style="font-size:1.12rem;font-weight:700;">@${kullanici.isim}</div>
        <div id="profilKlan" style="margin-top:2px;">${seciliKlanObj.logo} ${seciliKlanObj.name}</div>
      </div>
    </div>
    <div style="display:flex;gap:15px;flex-wrap:wrap;margin-bottom:13px;">
      <div class="profilCard"><b>Seviye:</b> 8</div>
      <div class="profilCard"><b>R√ºtbe:</b> √ñnc√º</div>
      <div class="profilCard"><b>Puan:</b> 660</div>
      <div class="profilCard"><b>Arkada≈ü:</b> 5</div>
      <div class="profilCard"><b>Referans:</b> KLAN-${kullanici.isim.toUpperCase()}</div>
    </div>
    <button onclick="alert('Demo: G√∂revler a√ßƒ±lacak!')" class="fireBtn" style="margin-bottom:17px;">G√∂revler & R√ºtbe Paneli</button>
    <button onclick="alert('Demo: Arkada≈ülar a√ßƒ±lacak!')" class="fireBtn">Arkada≈ülar</button>
  `;
}
// BAYRAK
function bayrakPanelYukle(){
  let b = document.getElementById('tab-flag');
  b.innerHTML = `
    <h2>Bayrak Dik</h2>
    <div style="margin-bottom:13px;">≈ûu anki konuma bayrak dikmek ister misin?</div>
    <button class="fireBtn" onclick="alert('Demo: Bayrak dikildi!')">Bayrak Dik!</button>
    <div style="margin-top:22px;"><b>B√∂lgedeki bayraklar:</b></div>
    <ul style="margin-top:6px;text-align:left;display:inline-block;">
      <li>Mor Klan: 2</li>
      <li>Mavi Klan: 1</li>
      <li>Kƒ±rmƒ±zƒ± Klan: 1</li>
    </ul>
  `;
}
// QR ve DAVET
function qrPanelYukle(){
  let q = document.getElementById('tab-qr');
  q.innerHTML = `
    <h2>QR Kod</h2>
    <div>Arkada≈ü eklemek i√ßin QR kodunu g√∂ster!</div>
    <img src="https://api.qrserver.com/v1/create-qr-code/?data=KlanApp-${kullanici.isim}&size=110x110" style="margin:23px auto;border-radius:13px;display:block;">
    <button class="fireBtn" onclick="alert('Demo: QR Tara!')">QR Tara</button>
  `;
}
function davetPanelYukle(){
  let r = document.getElementById('tab-ref');
  r.innerHTML = `
    <h2>Davet & Referans</h2>
    <div>Referans Kodun: <span style="font-weight:700;">KLAN-${kullanici.isim.toUpperCase()}</span></div>
    <button class="fireBtn" onclick="navigator.clipboard.writeText('KLAN-${kullanici.isim.toUpperCase()}');alert('Kod kopyalandƒ±!')">Kopyala</button>
    <div style="margin-top:9px;font-size:.96rem;opacity:.7;">Her davet i√ßin <b>+50 jeton</b> kazanƒ±rsƒ±n!</div>
  `;
}
</script>
</body>
</html>
