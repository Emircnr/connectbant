<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Warfare - Ger√ßek D√ºnya Stratejisi</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #fff;
      overflow: hidden;
    }
    
    .orbitron { font-family: 'Orbitron', sans-serif; }
    
    /* Glass Effect */
    .glass {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(100, 180, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }
    
    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 0.95rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(59, 130, 246, 0.6);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #64748b, #475569);
      box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
    }
    
    /* Resource Badge */
    .resource {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid rgba(100, 180, 255, 0.3);
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
    }
    
    /* Map */
    #map {
      width: 100%;
      height: 100%;
      background: #0a0e1a;
    }
    
    /* Markers */
    .unit-marker, .building-marker {
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      border: 3px solid;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0, 0, 0, 0.6);
    }
    
    .unit-marker {
      width: 28px;
      height: 28px;
    }
    
    .building-marker {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      font-size: 22px;
    }
    
    .unit-marker.selected, .building-marker.selected {
      animation: pulse 1s infinite;
      box-shadow: 0 0 20px currentColor;
      border-width: 4px;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    
    /* Input */
    .input {
      width: 100%;
      padding: 0.75rem 1rem;
      background: rgba(30, 41, 59, 0.8);
      border: 2px solid rgba(100, 180, 255, 0.3);
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      outline: none;
    }
    
    .input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
    }
    
    /* Panel */
    .panel {
      width: 340px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(100, 180, 255, 0.2);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
    }
    
    /* Scrollbar */
    .scrollbar::-webkit-scrollbar { width: 6px; }
    .scrollbar::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
    .scrollbar::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }
    
    /* Log Entry */
    .log-entry {
      padding: 0.5rem;
      margin-bottom: 0.4rem;
      background: rgba(239, 68, 68, 0.15);
      border-left: 3px solid #ef4444;
      border-radius: 4px;
      font-size: 0.85rem;
      animation: slideIn 0.3s;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .hidden { display: none !important; }
    
    /* Title */
    .title {
      font-size: 3.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
    }
    
    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.3rem;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      transition: width 0.3s;
    }
  </style>
</head>
<body>

<!-- ===================== VIEW A: LOGIN ===================== -->
<div id="viewA" class="fixed inset-0 flex items-center justify-center z-50">
  <div class="glass rounded-2xl p-10 max-w-lg w-full mx-4 text-center">
    <h1 class="title orbitron mb-3">GLOBAL WARFARE</h1>
    <p class="text-xl text-blue-300 mb-8 font-bold">Real-World Strategy Combat</p>
    
    <input id="nickInput" type="text" placeholder="Komutan Adƒ±nƒ±z" class="input mb-6" />
    
    <button id="loginBtn" class="btn btn-primary w-full text-lg py-3">
      ‚ö° SAVA≈ûA KATIL
    </button>
  </div>
</div>

<!-- ===================== VIEW B: LOBBY ===================== -->
<div id="viewB" class="hidden fixed inset-0 flex items-center justify-center z-50">
  <div class="glass rounded-2xl p-8 max-w-2xl w-full mx-4">
    <h2 class="text-3xl font-black orbitron text-blue-400 mb-6 text-center">KOMUTA MERKEZƒ∞</h2>
    
    <div class="grid grid-cols-2 gap-4 mb-6">
      <button id="createRoomBtn" class="btn btn-primary py-5">
        ‚ûï YENƒ∞ SAVA≈û
      </button>
      <button id="joinRoomBtn" class="btn btn-success py-5">
        üö™ SAVA≈ûA KATIL
      </button>
    </div>
    
    <div id="joinPanel" class="hidden">
      <input id="roomIdInput" type="text" placeholder="Sava≈ü Kodu" class="input mb-3" />
      <button id="joinConfirmBtn" class="btn btn-success w-full">BAƒûLAN</button>
    </div>
    
    <p class="text-center mt-4 text-blue-300">
      Komutan: <span id="userDisplay" class="font-bold"></span>
    </p>
  </div>
</div>

<!-- ===================== VIEW C: ROOM ===================== -->
<div id="viewC" class="hidden fixed inset-0 flex items-center justify-center z-50">
  <div class="glass rounded-2xl p-8 max-w-2xl w-full mx-4">
    <h2 class="text-3xl font-black orbitron text-blue-400 mb-3 text-center">SAVA≈û ODASI</h2>
    <p class="text-center text-lg mb-6">
      Kod: <span id="roomDisplay" class="text-blue-300 font-mono font-bold text-2xl"></span>
    </p>
    
    <div id="playersList" class="mb-6 space-y-3"></div>
    
    <div class="flex gap-3">
      <button id="readyBtn" class="btn btn-success flex-1 py-3">‚úì HAZIR</button>
      <button id="startBtn" class="btn btn-primary flex-1 py-3 hidden">üöÄ BA≈ûLAT</button>
      <button id="leaveRoomBtn" class="btn btn-danger px-6 py-3">√áIKI≈û</button>
    </div>
  </div>
</div>

<!-- ===================== VIEW D: GAME ===================== -->
<div id="viewD" class="hidden fixed inset-0 flex flex-col">
  
  <!-- TOP BAR -->
  <div class="glass p-3 flex items-center justify-between z-20">
    <div class="flex gap-3 flex-wrap">
      <div class="resource"><span class="text-xl">üí∞</span><span id="rMoney">500</span></div>
      <div class="resource"><span class="text-xl">üõ¢Ô∏è</span><span id="rOil">200</span></div>
      <div class="resource"><span class="text-xl">‚õìÔ∏è</span><span id="rIron">150</span></div>
      <div class="resource"><span class="text-xl">üíé</span><span id="rRare">50</span></div>
      <div class="resource"><span class="text-xl">üë•</span><span id="rPop">0</span>/<span id="rPopMax">200</span></div>
    </div>
    
    <div class="flex gap-2">
      <button id="helpBtn" class="btn btn-secondary text-sm px-3 py-2">‚ùì</button>
      <button id="exitBtn" class="btn btn-danger text-sm px-3 py-2">√áIKI≈û</button>
    </div>
  </div>
  
  <!-- MAIN AREA -->
  <div class="flex-1 flex overflow-hidden">
    
    <!-- LEFT PANEL -->
    <div class="panel p-4 overflow-y-auto scrollbar">
      <h3 class="text-xl font-black text-blue-400 mb-3">üèóÔ∏è ƒ∞N≈ûAAT & √úRETƒ∞M</h3>
      
      <div class="mb-4">
        <button id="buildBtn" class="btn btn-primary w-full mb-2">ƒ∞N≈ûAAT</button>
        <div id="buildMenu" class="hidden space-y-2"></div>
      </div>
      
      <div>
        <button id="produceBtn" class="btn btn-success w-full mb-2">Bƒ∞Rƒ∞M √úRETƒ∞Mƒ∞</button>
        <div id="produceMenu" class="hidden space-y-2">
          <p class="text-sm text-gray-400 text-center">Bina se√ßin</p>
        </div>
      </div>
    </div>
    
    <!-- MAP -->
    <div class="flex-1 relative">
      <div id="map"></div>
    </div>
    
    <!-- RIGHT PANEL -->
    <div class="panel p-4 overflow-y-auto scrollbar">
      <h3 class="text-xl font-black text-blue-400 mb-3">üìä Bƒ∞LGƒ∞</h3>
      
      <div class="mb-4">
        <h4 class="font-bold text-blue-300 mb-2">Se√ßili</h4>
        <div id="selectedInfo" class="text-sm">
          <p class="text-gray-500">Se√ßim yok</p>
        </div>
      </div>
      
      <div class="mb-4">
        <h4 class="font-bold text-blue-300 mb-2">√úretim Kuyruƒüu</h4>
        <div id="queueInfo" class="text-sm space-y-1"></div>
      </div>
      
      <div>
        <h4 class="font-bold text-red-400 mb-2">‚öîÔ∏è Sava≈ü G√ºnl√ºƒü√º</h4>
        <div id="combatLog" class="space-y-1 max-h-72 overflow-y-auto scrollbar"></div>
      </div>
    </div>
  </div>
  
  <!-- BOTTOM HINT -->
  <div class="glass p-2 text-center text-sm font-semibold text-blue-300">
    <span id="hint">Tƒ±kla se√ß | Tekrar tƒ±kla hareket/saldƒ±r | Sadece kep√ßeler in≈üaat yapar</span>
  </div>
</div>

<!-- ===================== MODALS ===================== -->
<div id="helpModal" class="hidden modal">
  <div class="glass rounded-2xl p-8 max-w-xl">
    <h2 class="text-2xl font-black text-blue-400 mb-4 text-center">YARDIM</h2>
    <div class="space-y-3 text-base">
      <p>üéØ <strong>Se√ß:</strong> Birime tƒ±kla</p>
      <p>üéØ <strong>Hareket/Saldƒ±r:</strong> Hedefe tƒ±kla (menzil i√ßindeyse saldƒ±rƒ±r)</p>
      <p>üèóÔ∏è <strong>ƒ∞n≈üaat:</strong> Sadece kep√ßeler in≈üaat yapabilir</p>
      <p>üí∞ <strong>Ekonomi:</strong> Madenler gelir √ºretir, birimler kaynak harcar</p>
      <p>üéñÔ∏è <strong>Hedef:</strong> D√º≈üman HQ'yu yok et!</p>
    </div>
    <button id="closeHelpBtn" class="btn btn-primary w-full mt-6">ANLADIM</button>
  </div>
</div>

<div id="resultModal" class="hidden modal">
  <div class="glass rounded-2xl p-10 text-center max-w-md">
    <h2 id="resultTitle" class="text-4xl font-black mb-4"></h2>
    <p id="resultText" class="text-xl mb-6"></p>
    <button id="closeResultBtn" class="btn btn-primary w-full py-3">LOBIYE D√ñN</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// ============================================
// FIREBASE
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyCV609XeHMtmZtD3FZDJ0cQnDiXke4YlUs",
  authDomain: "globalrts-ea3b4.firebaseapp.com",
  databaseURL: "https://globalrts-ea3b4-default-rtdb.firebaseio.com",
  projectId: "globalrts-ea3b4",
  storageBucket: "globalrts-ea3b4.firebasestorage.app",
  messagingSenderId: "404807030737",
  appId: "1:404807030737:web:2efecfef884db0b58632f0"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// ============================================
// STATE
// ============================================
const state = {
  view: 'A',
  uid: null,
  nick: null,
  roomId: null,
  isHost: false,
  started: false,
  
  tick: 0,
  entities: new Map(),
  selected: null,
  team: null,
  
  res: { money: 500, oil: 200, iron: 150, rare: 50, pop: 0, popMax: 200 },
  
  cmdBuffer: [],
  lastSim: 0,
  running: false,
  
  map: null,
  mapReady: false,
  rangeCircle: null,
  
  log: [],
  
  seed: 0,
  rng: null
};

// ============================================
// CONSTANTS - GER√áEK MENZƒ∞LLER (METRE)
// ============================================
const WORLD_SCALE = 100; // 1 leaflet unit = 100m
const TICK_RATE = 10;
const DT = 0.1;
const INPUT_DELAY = 3;
const INCOME_TICKS = 30; // 3 saniye

// Bƒ∞Rƒ∞MLER - Ger√ßek√ßi menziller ve hƒ±zlar
const UNITS = {
  // Kep√ße - ƒ∞n≈üaat i√ßin
  Excavator: {
    name: 'Kep√ße',
    icon: 'üöú',
    hp: 150,
    speed: 8, // m/s
    range: 0,
    dps: 0,
    cost: { money: 100, oil: 30 },
    time: 10,
    builds: true // Sadece kep√ße in≈üaat yapabilir
  },
  
  // Piyade Birimleri
  Infantry: {
    name: 'Piyade',
    icon: 'ü™ñ',
    hp: 100,
    speed: 1.4, // m/s (~5 km/h)
    range: 250, // m
    dps: 10,
    fireRate: 6,
    cost: { money: 50 },
    time: 6
  },
  
  MG_Team: {
    name: 'Makineli T√ºfek Timi',
    icon: '‚öîÔ∏è',
    hp: 120,
    speed: 1.2,
    range: 600,
    dps: 25,
    fireRate: 10,
    cost: { money: 80 },
    time: 8
  },
  
  Sniper: {
    name: 'Keskin Ni≈üancƒ±',
    icon: 'üéØ',
    hp: 80,
    speed: 1.3,
    range: 1200,
    dps: 50,
    fireRate: 0.5,
    cost: { money: 120, rare: 5 },
    time: 12
  },
  
  AT_Team: {
    name: 'Tanksavar Timi',
    icon: 'üöÄ',
    hp: 100,
    speed: 1.2,
    range: 3000,
    dps: 80,
    fireRate: 0.3,
    cost: { money: 200, iron: 30 },
    time: 15
  },
  
  // Ara√ßlar
  Jeep: {
    name: 'Hafif Ara√ß',
    icon: 'üöô',
    hp: 200,
    speed: 18, // ~65 km/h
    range: 400,
    dps: 15,
    fireRate: 8,
    cost: { money: 150, oil: 40 },
    time: 10
  },
  
  APC: {
    name: 'Zƒ±rhlƒ± Personel Ta≈üƒ±yƒ±cƒ±',
    icon: 'üöê',
    hp: 400,
    speed: 15, // ~54 km/h
    range: 800,
    dps: 30,
    fireRate: 5,
    cost: { money: 250, oil: 80, iron: 60 },
    time: 18
  },
  
  IFV: {
    name: 'Piyade Sava≈ü Aracƒ±',
    icon: 'üî´',
    hp: 500,
    speed: 16,
    range: 1500,
    dps: 45,
    fireRate: 4,
    cost: { money: 400, oil: 100, iron: 120 },
    time: 22
  },
  
  // Tanklar
  Light_Tank: {
    name: 'Hafif Tank',
    icon: 'üõ°Ô∏è',
    hp: 600,
    speed: 14,
    range: 2500,
    dps: 60,
    fireRate: 1,
    cost: { money: 500, oil: 120, iron: 150 },
    time: 25
  },
  
  MBT: {
    name: 'Ana Muharebe Tankƒ±',
    icon: '‚öôÔ∏è',
    hp: 1000,
    speed: 12,
    range: 4000,
    dps: 120,
    fireRate: 0.4,
    cost: { money: 800, oil: 200, iron: 300 },
    time: 35
  },
  
  Heavy_Tank: {
    name: 'Aƒüƒ±r Tank',
    icon: 'üèãÔ∏è',
    hp: 1500,
    speed: 10,
    range: 4500,
    dps: 150,
    fireRate: 0.3,
    cost: { money: 1200, oil: 300, iron: 450, rare: 20 },
    time: 45
  },
  
  // Top√ßu
  Artillery: {
    name: 'Top√ßu',
    icon: 'üí£',
    hp: 300,
    speed: 8,
    range: 25000, // 25km
    dps: 80,
    fireRate: 0.2,
    cost: { money: 600, oil: 150, iron: 200 },
    time: 30
  },
  
  MLRS: {
    name: '√áok Namlulu Roketatar',
    icon: 'üí•',
    hp: 350,
    speed: 10,
    range: 70000, // 70km
    dps: 100,
    fireRate: 0.1,
    cost: { money: 900, oil: 250, iron: 300 },
    time: 40
  },
  
  // Hava Ara√ßlarƒ±
  Attack_Heli: {
    name: 'Saldƒ±rƒ± Helikopteri',
    icon: 'üöÅ',
    hp: 400,
    speed: 70, // ~252 km/h
    range: 6000,
    dps: 70,
    fireRate: 3,
    cost: { money: 1000, oil: 300, rare: 30 },
    time: 35
  },
  
  Drone: {
    name: 'Silahlƒ± ƒ∞HA',
    icon: '‚úàÔ∏è',
    hp: 200,
    speed: 40,
    range: 8000,
    dps: 40,
    fireRate: 2,
    cost: { money: 600, oil: 150, rare: 20 },
    time: 25
  }
};

// Bƒ∞NALAR
const BUILDINGS = {
  HQ: {
    name: 'Merkez √ús',
    icon: 'üèõÔ∏è',
    hp: 2000,
    produces: ['Excavator', 'Infantry'],
    cost: {},
    time: 0
  },
  
  Barracks: {
    name: 'Kƒ±≈üla',
    icon: 'üè∞',
    hp: 800,
    produces: ['Infantry', 'MG_Team', 'Sniper', 'AT_Team'],
    cost: { money: 200 },
    time: 25
  },
  
  Vehicle_Factory: {
    name: 'Ara√ß Fabrikasƒ±',
    icon: 'üè≠',
    hp: 1000,
    produces: ['Jeep', 'APC', 'IFV'],
    cost: { money: 350, oil: 80, iron: 100 },
    time: 35
  },
  
  Tank_Factory: {
    name: 'Tank Fabrikasƒ±',
    icon: 'üîß',
    hp: 1200,
    produces: ['Light_Tank', 'MBT', 'Heavy_Tank'],
    cost: { money: 500, oil: 150, iron: 200 },
    time: 45
  },
  
  Artillery_Base: {
    name: 'Top√ßu √úss√º',
    icon: 'üéñÔ∏è',
    hp: 900,
    produces: ['Artillery', 'MLRS'],
    cost: { money: 450, iron: 150 },
    time: 40
  },
  
  Airfield: {
    name: 'Hava √úss√º',
    icon: 'üõ´',
    hp: 1100,
    produces: ['Attack_Heli', 'Drone'],
    cost: { money: 800, oil: 200, rare: 30 },
    time: 50
  },
  
  // Ekonomi Binalarƒ±
  Money_Gen: {
    name: 'Ekonomi Merkezi',
    icon: 'üè¶',
    hp: 600,
    income: { money: 15 },
    cost: { money: 250 },
    time: 20
  },
  
  Oil_Refinery: {
    name: 'Petrol Rafinerisi',
    icon: 'üõ¢Ô∏è',
    hp: 700,
    income: { oil: 8 },
    cost: { money: 300, iron: 50 },
    time: 25
  },
  
  Iron_Mine: {
    name: 'Demir Madeni',
    icon: '‚õìÔ∏è',
    hp: 750,
    income: { iron: 6 },
    cost: { money: 350, oil: 40 },
    time: 28
  },
  
  Rare_Mine: {
    name: 'Nadir Element Madeni',
    icon: 'üíé',
    hp: 800,
    income: { rare: 3 },
    cost: { money: 500, iron: 80 },
    time: 35
  },
  
  Power_Plant: {
    name: 'Enerji Santrali',
    icon: '‚ö°',
    hp: 900,
    income: { money: 10, oil: 5 },
    cost: { money: 400, iron: 100 },
    time: 30
  }
};

// ============================================
// RNG
// ============================================
class RNG {
  constructor(seed) { this.s = seed; }
  next() { this.s = (this.s * 9301 + 49297) % 233280; return this.s / 233280; }
  range(a, b) { return a + this.next() * (b - a); }
}

// ============================================
// ENTITIES
// ============================================
class Entity {
  constructor(id, type, team, lat, lng) {
    this.id = id;
    this.type = type;
    this.team = team;
    this.lat = lat;
    this.lng = lng;
    this.marker = null;
  }
  
  destroy() {
    if (this.marker) {
      state.map.removeLayer(this.marker);
      this.marker = null;
    }
    if (state.selected === this.id) {
      state.selected = null;
      updateUI();
    }
  }
}

class Unit extends Entity {
  constructor(id, type, team, lat, lng, stats) {
    super(id, type, team, lat, lng);
    this.stats = { ...stats };
    this.hp = stats.hp;
    this.target = null;
    this.cooldown = 0;
  }
  
  update(dt) {
    if (this.cooldown > 0) this.cooldown -= dt;
    
    // Otomatik d√º≈üman tarama
    if (!this.target && this.stats.range > 0) {
      this.findEnemy();
    }
    
    if (this.target) {
      if (this.target.id) {
        // D√º≈ümana saldƒ±r
        const enemy = state.entities.get(this.target.id);
        if (enemy && enemy.hp > 0) {
          const dist = this.distTo(enemy) * WORLD_SCALE;
          
          if (dist <= this.stats.range) {
            // Menzil i√ßinde - ate≈ü
            if (this.cooldown <= 0 && this.stats.dps > 0) {
              const dmg = this.stats.dps / this.stats.fireRate;
              enemy.hp -= dmg;
              this.cooldown = 1 / this.stats.fireRate;
              
              drawBeam(this.lat, this.lng, enemy.lat, enemy.lng);
              
              if (enemy.hp <= 0) {
                log(`${this.stats.name} bir ${enemy.stats.name} imha etti!`);
                destroy(enemy.id);
                if (enemy.type === 'HQ') endGame(this.team);
              }
            }
          } else {
            // Yakla≈ü
            this.moveTo(enemy.lat, enemy.lng, dt);
          }
        } else {
          this.target = null;
        }
      } else {
        // Pozisyona hareket
        const dist = Math.sqrt(
          (this.target.lat - this.lat)**2 + 
          (this.target.lng - this.lng)**2
        );
        
        if (dist > 0.0001) {
          this.moveTo(this.target.lat, this.target.lng, dt);
        } else {
          this.target = null;
        }
      }
    }
  }
  
  findEnemy() {
    const scanRange = (this.stats.range + 500) / WORLD_SCALE;
    let closest = null;
    let minDist = Infinity;
    
    state.entities.forEach(e => {
      if (e.team !== this.team && e.hp > 0) {
        const d = this.distTo(e);
        if (d < scanRange && d < minDist) {
          closest = e;
          minDist = d;
        }
      }
    });
    
    if (closest) {
      this.target = { id: closest.id };
    }
  }
  
  moveTo(lat, lng, dt) {
    const dx = lng - this.lng;
    const dy = lat - this.lat;
    const dist = Math.sqrt(dx*dx + dy*dy);
    const speed = this.stats.speed / WORLD_SCALE * dt;
    const ratio = Math.min(1, speed / dist);
    this.lng += dx * ratio;
    this.lat += dy * ratio;
  }
  
  distTo(e) {
    return Math.sqrt((e.lng - this.lng)**2 + (e.lat - this.lat)**2);
  }
  
  createMarker() {
    const color = this.team === 'p1' ? '#3b82f6' : '#ef4444';
    const icon = L.divIcon({
      className: '',
      html: `<div class="unit-marker" style="border-color:${color};color:${color};">${this.stats.icon}</div>`,
      iconSize: [28, 28]
    });
    
    this.marker = L.marker([this.lat, this.lng], { icon });
    this.marker.entityId = this.id;
    this.marker.addTo(state.map);
    this.marker.on('click', (e) => {
      L.DomEvent.stopPropagation(e);
      handleClick(this.id);
    });
  }
  
  updatePos() {
    if (this.marker) {
      this.marker.setLatLng([this.lat, this.lng]);
    }
  }
}

class Building extends Entity {
  constructor(id, type, team, lat, lng, stats) {
    super(id, type, team, lat, lng);
    this.stats = { ...stats };
    this.hp = stats.hp;
    this.queue = [];
  }
  
  update(dt) {
    // Gelir
    if (this.stats.income && state.tick % INCOME_TICKS === 0 && this.team === state.team) {
      Object.entries(this.stats.income).forEach(([k, v]) => {
        state.res[k] += v;
      });
    }
    
    // √úretim
    if (this.queue.length > 0) {
      const item = this.queue[0];
      item.progress += dt;
      
      if (item.progress >= item.time) {
        this.queue.shift();
        if (this.team === state.team) {
          spawn(item.unit, this.team, this.lat + 0.002, this.lng + 0.002);
          log(`${UNITS[item.unit].name} hazƒ±r!`);
        }
      }
    }
  }
  
  createMarker() {
    const color = this.team === 'p1' ? '#3b82f6' : '#ef4444';
    const icon = L.divIcon({
      className: '',
      html: `<div class="building-marker" style="border-color:${color};color:${color};">${this.stats.icon}</div>`,
      iconSize: [40, 40]
    });
    
    this.marker = L.marker([this.lat, this.lng], { icon });
    this.marker.entityId = this.id;
    this.marker.addTo(state.map);
    this.marker.on('click', (e) => {
      L.DomEvent.stopPropagation(e);
      handleClick(this.id);
    });
  }
  
  updatePos() {}
}

// ============================================
// ENTITY MANAGEMENT
// ============================================
function spawn(type, team, lat, lng) {
  const id = `u${Date.now()}${Math.random()}`;
  const stats = UNITS[type];
  const unit = new Unit(id, type, team, lat, lng, stats);
  state.entities.set(id, unit);
  
  if (state.mapReady) unit.createMarker();
  if (team === state.team) state.res.pop++;
  
  return unit;
}

function build(type, team, lat, lng) {
  const id = `b${Date.now()}${Math.random()}`;
  const stats = BUILDINGS[type];
  const building = new Building(id, type, team, lat, lng, stats);
  state.entities.set(id, building);
  
  if (state.mapReady) building.createMarker();
  
  return building;
}

function destroy(id) {
  const e = state.entities.get(id);
  if (e) {
    e.destroy();
    state.entities.delete(id);
    if (e instanceof Unit && e.team === state.team) {
      state.res.pop = Math.max(0, state.res.pop - 1);
    }
  }
}

// ============================================
// CLICK HANDLER
// ============================================
function handleClick(id) {
  const e = state.entities.get(id);
  if (!e || e.team !== state.team) return;
  
  if (state.selected === id) {
    // Zaten se√ßili - hareket/saldƒ±r i√ßin bekle
    document.getElementById('hint').textContent = 'üìç Hedefe tƒ±klayƒ±n';
    return;
  }
  
  state.selected = id;
  updateUI();
}

function handleMapClick(latlng) {
  if (!state.selected) return;
  
  const e = state.entities.get(state.selected);
  if (!e || !(e instanceof Unit)) return;
  
  // Hedef kontrol - d√º≈üman mƒ±?
  let targetEnemy = null;
  state.entities.forEach(ent => {
    if (ent.team !== state.team && ent.marker) {
      const d = state.map.distance(latlng, ent.marker.getLatLng());
      if (d < 100) targetEnemy = ent;
    }
  });
  
  if (targetEnemy) {
    // Saldƒ±r
    state.cmdBuffer.push({
      type: 'ATTACK',
      unitId: e.id,
      targetId: targetEnemy.id
    });
    log(`${e.stats.name} saldƒ±rƒ±ya ge√ßti`);
  } else {
    // Hareket
    state.cmdBuffer.push({
      type: 'MOVE',
      unitId: e.id,
      lat: latlng.lat,
      lng: latlng.lng
    });
  }
}

// ============================================
// UI UPDATE
// ============================================
function updateUI() {
  // Marker se√ßimi
  state.entities.forEach(e => {
    if (e.marker && e.marker.getElement()) {
      const el = e.marker.getElement().querySelector('.unit-marker, .building-marker');
      if (el) {
        el.classList.toggle('selected', state.selected === e.id);
      }
    }
  });
  
  // Menzil
  if (state.rangeCircle) {
    state.map.removeLayer(state.rangeCircle);
    state.rangeCircle = null;
  }
  
  if (state.selected) {
    const e = state.entities.get(state.selected);
    if (e instanceof Unit && e.stats.range > 0) {
      state.rangeCircle = L.circle([e.lat, e.lng], {
        radius: e.stats.range,
        color: e.team === 'p1' ? '#3b82f6' : '#ef4444',
        fillOpacity: 0.1,
        weight: 2
      }).addTo(state.map);
    }
  }
  
  updateSelectedInfo();
  updateProduceMenu();
}

function updateSelectedInfo() {
  const div = document.getElementById('selectedInfo');
  
  if (!state.selected) {
    div.innerHTML = '<p class="text-gray-500">Se√ßim yok</p>';
    return;
  }
  
  const e = state.entities.get(state.selected);
  if (!e) {
    div.innerHTML = '<p class="text-gray-500">Se√ßim yok</p>';
    return;
  }
  
  const hp = Math.round(e.hp);
  const maxHp = e.stats.hp;
  const hpPct = (hp / maxHp * 100).toFixed(0);
  
  let html = `
    <div class="glass p-2 rounded">
      <div class="text-lg mb-1">${e.stats.icon} ${e.stats.name}</div>
      <div class="text-sm">‚ù§Ô∏è ${hp}/${maxHp} (${hpPct}%)</div>
  `;
  
  if (e instanceof Unit) {
    html += `
      <div class="text-sm text-blue-300">üìè ${e.stats.range}m</div>
      <div class="text-sm text-red-300">‚öîÔ∏è ${e.stats.dps} DPS</div>
    `;
  }
  
  html += '</div>';
  div.innerHTML = html;
}

function updateResourceUI() {
  document.getElementById('rMoney').textContent = Math.floor(state.res.money);
  document.getElementById('rOil').textContent = Math.floor(state.res.oil);
  document.getElementById('rIron').textContent = Math.floor(state.res.iron);
  document.getElementById('rRare').textContent = Math.floor(state.res.rare);
  document.getElementById('rPop').textContent = state.res.pop;
}

function updateQueueUI() {
  const div = document.getElementById('queueInfo');
  const items = [];
  
  state.entities.forEach(e => {
    if (e instanceof Building && e.team === state.team && e.queue.length > 0) {
      e.queue.forEach(q => {
        const pct = (q.progress / q.time * 100).toFixed(0);
        items.push(`${UNITS[q.unit].icon} ${pct}%`);
      });
    }
  });
  
  if (items.length === 0) {
    div.innerHTML = '<p class="text-gray-500 text-xs">Kuyruk bo≈ü</p>';
  } else {
    div.innerHTML = items.map(i => `<div class="glass p-1 rounded text-xs">${i}</div>`).join('');
  }
}

// ============================================
// BUILD & PRODUCE MENUS
// ============================================
document.getElementById('buildBtn').addEventListener('click', () => {
  const menu = document.getElementById('buildMenu');
  menu.classList.toggle('hidden');
  
  if (!menu.classList.contains('hidden') && menu.children.length === 0) {
    Object.entries(BUILDINGS).forEach(([type, stats]) => {
      if (type === 'HQ') return;
      
      const btn = document.createElement('button');
      btn.className = 'btn btn-secondary w-full text-left text-xs py-2';
      btn.innerHTML = `${stats.icon} ${stats.name}<br><span class="text-xs opacity-75">${fmtCost(stats.cost)}</span>`;
      btn.onclick = () => startBuild(type);
      menu.appendChild(btn);
    });
  }
});

document.getElementById('produceBtn').addEventListener('click', () => {
  const menu = document.getElementById('produceMenu');
  menu.classList.toggle('hidden');
});

function updateProduceMenu() {
  const menu = document.getElementById('produceMenu');
  
  if (!state.selected) {
    menu.innerHTML = '<p class="text-sm text-gray-400 text-center">Bina se√ßin</p>';
    return;
  }
  
  const e = state.entities.get(state.selected);
  if (!(e instanceof Building) || !e.stats.produces) {
    menu.innerHTML = '<p class="text-sm text-gray-400 text-center">√úretim yapamaz</p>';
    return;
  }
  
  menu.innerHTML = '';
  e.stats.produces.forEach(unit => {
    const s = UNITS[unit];
    const btn = document.createElement('button');
    btn.className = 'btn btn-success w-full text-left text-xs py-2';
    btn.innerHTML = `${s.icon} ${s.name}<br><span class="text-xs opacity-75">${fmtCost(s.cost)}</span>`;
    btn.onclick = () => {
      state.cmdBuffer.push({
        type: 'PRODUCE',
        buildingId: e.id,
        unit: unit
      });
    };
    menu.appendChild(btn);
  });
}

function startBuild(type) {
  // Sadece kep√ße in≈üaat yapabilir
  const sel = state.entities.get(state.selected);
  if (!sel || !(sel instanceof Unit) || !sel.stats.builds) {
    log('‚ùå Sadece kep√ßeler in≈üaat yapabilir!');
    return;
  }
  
  document.getElementById('hint').textContent = `üèóÔ∏è ${BUILDINGS[type].name} - Konum se√ßin`;
  
  const handler = (e) => {
    state.cmdBuffer.push({
      type: 'BUILD',
      buildingType: type,
      lat: e.latlng.lat,
      lng: e.latlng.lng
    });
    
    state.map.off('click', handler);
    document.getElementById('hint').textContent = '‚úì ƒ∞n≈üaat emri verildi';
  };
  
  state.map.once('click', handler);
}

function fmtCost(cost) {
  const p = [];
  if (cost.money) p.push(`üí∞${cost.money}`);
  if (cost.oil) p.push(`üõ¢Ô∏è${cost.oil}`);
  if (cost.iron) p.push(`‚õìÔ∏è${cost.iron}`);
  if (cost.rare) p.push(`üíé${cost.rare}`);
  return p.join(' ');
}

// ============================================
// BEAM
// ============================================
function drawBeam(lat1, lng1, lat2, lng2) {
  if (!state.map) return;
  
  const line = L.polyline([[lat1, lng1], [lat2, lng2]], {
    color: '#ff6600',
    weight: 3,
    opacity: 1
  }).addTo(state.map);
  
  setTimeout(() => state.map.removeLayer(line), 120);
}

// ============================================
// LOG
// ============================================
function log(msg) {
  state.log.unshift(msg);
  if (state.log.length > 30) state.log.pop();
  
  const div = document.getElementById('combatLog');
  const entry = document.createElement('div');
  entry.className = 'log-entry';
  entry.textContent = msg;
  div.insertBefore(entry, div.firstChild);
  
  if (div.children.length > 30) {
    div.removeChild(div.lastChild);
  }
}

// ============================================
// VIEWS
// ============================================
function show(v) {
  ['A', 'B', 'C', 'D'].forEach(x => {
    document.getElementById(`view${x}`).classList.toggle('hidden', x !== v);
  });
  state.view = v;
  
  if (v === 'D' && !state.mapReady) {
    setTimeout(initMap, 100);
  }
}

// ============================================
// AUTH
// ============================================
document.getElementById('loginBtn').onclick = async () => {
  try {
    const res = await auth.signInAnonymously();
    state.uid = res.user.uid;
    state.nick = document.getElementById('nickInput').value.trim() || `Commander${Math.floor(Math.random()*1000)}`;
    document.getElementById('userDisplay').textContent = state.nick;
    show('B');
  } catch (err) {
    alert('Hata: ' + err.message);
  }
};

// ============================================
// ROOM
// ============================================
document.getElementById('createRoomBtn').onclick = async () => {
  const roomId = genId();
  const seed = Math.floor(Math.random() * 1000000);
  
  await db.ref(`rooms/${roomId}/meta`).set({
    created: Date.now(),
    seed: seed,
    host: state.uid
  });
  
  await db.ref(`rooms/${roomId}/players/${state.uid}`).set({
    nick: state.nick,
    side: 'p1',
    ready: false
  });
  
  state.roomId = roomId;
  state.isHost = true;
  state.team = 'p1';
  
  joinRoom(roomId);
};

document.getElementById('joinRoomBtn').onclick = () => {
  document.getElementById('joinPanel').classList.remove('hidden');
};

document.getElementById('joinConfirmBtn').onclick = async () => {
  const roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
  if (!roomId) return;
  
  const snap = await db.ref(`rooms/${roomId}/meta`).once('value');
  if (!snap.exists()) {
    alert('Oda bulunamadƒ±!');
    return;
  }
  
  const pSnap = await db.ref(`rooms/${roomId}/players`).once('value');
  const players = pSnap.val() || {};
  
  if (Object.keys(players).length >= 2) {
    alert('Oda dolu!');
    return;
  }
  
  const side = Object.keys(players).length === 0 ? 'p1' : 'p2';
  
  await db.ref(`rooms/${roomId}/players/${state.uid}`).set({
    nick: state.nick,
    side: side,
    ready: false
  });
  
  state.roomId = roomId;
  state.isHost = false;
  state.team = side;
  
  joinRoom(roomId);
};

function joinRoom(id) {
  document.getElementById('roomDisplay').textContent = id;
  show('C');
  
  db.ref(`rooms/${id}/players`).on('value', updatePlayers);
  db.ref(`rooms/${id}/meta`).on('value', (snap) => {
    const meta = snap.val();
    if (meta && meta.started && !state.started) {
      startGame(meta);
    }
  });
}

function updatePlayers(snap) {
  const players = snap.val() || {};
  const div = document.getElementById('playersList');
  div.innerHTML = '';
  
  let ready = true;
  let count = 0;
  
  Object.entries(players).forEach(([uid, data]) => {
    count++;
    const el = document.createElement('div');
    el.className = 'glass p-3 rounded';
    el.innerHTML = `
      <div class="flex justify-between">
        <div>
          <span class="font-bold">${data.nick}</span>
          <span class="text-sm text-gray-400 ml-2">${data.side === 'p1' ? 'üîµ' : 'üî¥'}</span>
        </div>
        <span class="${data.ready ? 'text-green-400' : 'text-yellow-400'}">${data.ready ? '‚úì' : '‚è≥'}</span>
      </div>
    `;
    div.appendChild(el);
    
    if (!data.ready) ready = false;
  });
  
  if (state.isHost && count >= 2 && ready) {
    document.getElementById('startBtn').classList.remove('hidden');
  } else {
    document.getElementById('startBtn').classList.add('hidden');
  }
}

document.getElementById('readyBtn').onclick = async () => {
  const ref = db.ref(`rooms/${state.roomId}/players/${state.uid}/ready`);
  const snap = await ref.once('value');
  const curr = snap.val() || false;
  await ref.set(!curr);
};

document.getElementById('startBtn').onclick = async () => {
  await db.ref(`rooms/${state.roomId}/meta/started`).set(Date.now());
};

document.getElementById('leaveRoomBtn').onclick = () => {
  leave();
  show('B');
};

function leave() {
  if (state.roomId) {
    db.ref(`rooms/${state.roomId}/players/${state.uid}`).remove();
    db.ref(`rooms/${state.roomId}`).off();
  }
  state.roomId = null;
  state.isHost = false;
  state.started = false;
}

// ============================================
// GAME START
// ============================================
async function startGame(meta) {
  state.started = true;
  state.seed = meta.seed;
  state.rng = new RNG(meta.seed);
  state.tick = 0;
  state.lastSim = Date.now();
  
  show('D');
  
  await initWorld();
  
  db.ref(`rooms/${state.roomId}/approved`).on('child_added', (snap) => {
    const tick = parseInt(snap.key);
    const data = snap.val();
    if (data && data.cmds) {
      applyCmds(tick, data.cmds);
    }
  });
  
  state.running = true;
  simLoop();
  requestAnimationFrame(renderLoop);
  
  log('üéñÔ∏è SAVA≈û BA≈ûLADI!');
}

async function initWorld() {
  // Rastgele spawn
  const baseLat = state.rng.range(30, 55);
  const baseLng = state.rng.range(15, 50);
  
  const p1Lat = baseLat + state.rng.range(-0.05, 0.05);
  const p1Lng = baseLng + state.rng.range(-0.08, -0.03);
  
  const p2Lat = baseLat + state.rng.range(-0.05, 0.05);
  const p2Lng = baseLng + state.rng.range(0.03, 0.08);
  
  // P1
  build('HQ', 'p1', p1Lat, p1Lng);
  build('Barracks', 'p1', p1Lat + 0.005, p1Lng);
  build('Money_Gen', 'p1', p1Lat - 0.005, p1Lng);
  
  spawn('Excavator', 'p1', p1Lat - 0.003, p1Lng);
  for (let i = 0; i < 6; i++) {
    spawn('Infantry', 'p1', p1Lat + state.rng.range(-0.004, 0.004), p1Lng + state.rng.range(-0.004, 0.004));
  }
  spawn('Jeep', 'p1', p1Lat - 0.006, p1Lng + 0.002);
  
  // P2
  build('HQ', 'p2', p2Lat, p2Lng);
  build('Barracks', 'p2', p2Lat + 0.005, p2Lng);
  build('Money_Gen', 'p2', p2Lat - 0.005, p2Lng);
  
  spawn('Excavator', 'p2', p2Lat - 0.003, p2Lng);
  for (let i = 0; i < 6; i++) {
    spawn('Infantry', 'p2', p2Lat + state.rng.range(-0.004, 0.004), p2Lng + state.rng.range(-0.004, 0.004));
  }
  spawn('Jeep', 'p2', p2Lat - 0.006, p2Lng - 0.002);
  
  if (state.map) {
    state.map.setView([baseLat, baseLng], 12);
  }
}

// ============================================
// SIMULATION
// ============================================
function simLoop() {
  if (!state.running) return;
  
  const now = Date.now();
  const elapsed = (now - state.lastSim) / 1000;
  
  if (elapsed >= DT) {
    state.lastSim = now;
    state.tick++;
    
    simulate(DT);
    
    if (state.cmdBuffer.length > 0) {
      sendCmds(state.tick + INPUT_DELAY, state.cmdBuffer);
      state.cmdBuffer = [];
    }
    
    if (state.isHost) {
      mergeCmds(state.tick);
    }
  }
  
  setTimeout(simLoop, 10);
}

function simulate(dt) {
  state.entities.forEach(e => {
    if (e.update) e.update(dt);
  });
  
  updateResourceUI();
  updateQueueUI();
}

function applyCmds(tick, cmds) {
  cmds.forEach(c => {
    try {
      if (c.type === 'MOVE') {
        const u = state.entities.get(c.unitId);
        if (u && u instanceof Unit) {
          u.target = { lat: c.lat, lng: c.lng };
        }
      } else if (c.type === 'ATTACK') {
        const u = state.entities.get(c.unitId);
        if (u && u instanceof Unit) {
          u.target = { id: c.targetId };
        }
      } else if (c.type === 'BUILD') {
        if (c.team === state.team) {
          const cost = BUILDINGS[c.buildingType].cost;
          if (canAfford(cost)) {
            deduct(cost);
            build(c.buildingType, c.team, c.lat, c.lng);
          }
        }
      } else if (c.type === 'PRODUCE') {
        const b = state.entities.get(c.buildingId);
        if (b && b instanceof Building && b.team === state.team) {
          const s = UNITS[c.unit];
          if (canAfford(s.cost)) {
            deduct(s.cost);
            b.queue.push({ unit: c.unit, time: s.time, progress: 0 });
          }
        }
      }
    } catch (err) {
      console.error(err);
    }
  });
}

// ============================================
// NETWORK
// ============================================
async function sendCmds(tick, cmds) {
  if (!state.roomId || tick <= state.tick) return;
  
  try {
    await db.ref(`rooms/${state.roomId}/commands/${tick}/${state.uid}`).set({
      cmds: cmds
    });
  } catch (err) {
    console.error(err);
  }
}

async function mergeCmds(tick) {
  try {
    const snap = await db.ref(`rooms/${state.roomId}/commands/${tick}`).once('value');
    const data = snap.val();
    
    const merged = [];
    if (data) {
      Object.values(data).forEach(d => {
        if (d.cmds) merged.push(...d.cmds);
      });
    }
    
    await db.ref(`rooms/${state.roomId}/approved/${tick}`).set({ cmds: merged });
  } catch (err) {
    console.error(err);
  }
}

// ============================================
// RENDER
// ============================================
function renderLoop() {
  state.entities.forEach(e => {
    if (e.updatePos) e.updatePos();
  });
  
  if (state.selected && state.rangeCircle) {
    const e = state.entities.get(state.selected);
    if (e) {
      state.rangeCircle.setLatLng([e.lat, e.lng]);
    }
  }
  
  requestAnimationFrame(renderLoop);
}

// ============================================
// MAP
// ============================================
function initMap() {
  if (state.mapReady) return;
  
  const map = L.map('map', {
    worldCopyJump: true,
    minZoom: 3,
    maxZoom: 18
  }).setView([40, 30], 6);
  
  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Esri'
  }).addTo(map);
  
  state.map = map;
  state.mapReady = true;
  
  state.entities.forEach(e => {
    if (e.createMarker) e.createMarker();
  });
  
  map.on('click', (e) => handleMapClick(e.latlng));
}

// ============================================
// ECONOMY
// ============================================
function canAfford(cost) {
  return Object.entries(cost).every(([k, v]) => (state.res[k] || 0) >= v);
}

function deduct(cost) {
  Object.entries(cost).forEach(([k, v]) => {
    state.res[k] -= v;
  });
}

// ============================================
// GAME END
// ============================================
function endGame(winner) {
  state.running = false;
  
  const won = winner === state.team;
  document.getElementById('resultTitle').textContent = won ? 'üèÜ ZAFER' : 'üíÄ YENƒ∞LGƒ∞';
  document.getElementById('resultText').textContent = won ? 'D√º≈üman √ºss√º yok edildi!' : '√úss√ºn√ºz d√º≈üt√º!';
  document.getElementById('resultModal').classList.remove('hidden');
}

document.getElementById('closeResultBtn').onclick = () => {
  document.getElementById('resultModal').classList.add('hidden');
  leave();
  show('B');
};

// ============================================
// UI
// ============================================
document.getElementById('helpBtn').onclick = () => {
  document.getElementById('helpModal').classList.remove('hidden');
};

document.getElementById('closeHelpBtn').onclick = () => {
  document.getElementById('helpModal').classList.add('hidden');
};

document.getElementById('exitBtn').onclick = () => {
  if (confirm('√áƒ±kmak istediƒüinize emin misiniz?')) {
    state.running = false;
    leave();
    show('B');
  }
};

// ============================================
// UTILS
// ============================================
function genId() {
  const c = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let id = '';
  for (let i = 0; i < 8; i++) id += c[Math.floor(Math.random() * c.length)];
  return id;
}

console.log('üåç Global Warfare ba≈ülatƒ±ldƒ±!');
</script>

</body>
</html>
